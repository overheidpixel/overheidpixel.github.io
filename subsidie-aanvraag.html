<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subsidie Aanvraag Formulier</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
</head>
<body>
    <header>
        <h1>Subsidie Aanvraag Formulier</h1>
        <p>Vul alle secties in om een volledig PDF-document te genereren</p>
    </header>

    <form id="subsidieForm">

        <!-- Sectie 1: Bedrijfsinformatie -->
        <section>
            <h2><i class="fas fa-info-circle"></i> Bedrijfsinformatie</h2>
        </section>

        <!-- Dynamische vragen -->
        <div id="formFields"></div>

        <!-- Sectie 2: Preview afbeeldingen -->
        <section>
            <h2><i class="fas fa-image"></i> Preview uploads</h2>
            <div class="preview">
                <div>
                    <label>Bankafschriften preview:</label>
                    <img id="previewBank" src="" alt="Bankafschriften Preview">
                </div>
                <div>
                    <label>Dashboard preview:</label>
                    <img id="previewDashboard" src="" alt="Dashboard Preview">
                </div>
            </div>
        </section>

        <button type="button" id="submitBtn"><i class="fas fa-download"></i> Download aanvraag als PDF</button>
    </form>

    <script>
        const { jsPDF } = window.jspdf;

        const vragen = [
            { label: "Bedrijfsnaam", type: "text", name: "bedrijf", required: true },
            { label: "Eigenaar", type: "text", name: "eigenaar", required: true },
            { label: "Bankafschriften (upload foto)", type: "file", name: "bankafschriften", accept: "image/*", required: true },
            { label: "Financieel dashboard (bossmenu screenshot)", type: "file", name: "dashboard", accept: "image/*", required: true },
            { label: "Omschrijf je aanvraag", type: "textarea", name: "omschrijving", required: true }
        ];

        const formFields = document.getElementById('formFields');
        vragen.forEach(vraag => {
            const label = document.createElement('label');
            label.textContent = vraag.label;
            formFields.appendChild(label);

            let input;
            if(vraag.type === "textarea") {
                input = document.createElement('textarea');
                input.rows = 5;
            } else {
                input = document.createElement('input');
                input.type = vraag.type;
                if(vraag.accept) input.accept = vraag.accept;
            }
            input.name = vraag.name;
            if(vraag.required) input.required = true;

            if(vraag.type === "file") {
                input.addEventListener('change', e => {
                    const reader = new FileReader();
                    reader.onload = function(ev) {
                        if(vraag.name === "bankafschriften") document.getElementById('previewBank').src = ev.target.result;
                        if(vraag.name === "dashboard") document.getElementById('previewDashboard').src = ev.target.result;
                    };
                    reader.readAsDataURL(e.target.files[0]);
                });
            }

            formFields.appendChild(input);
        });

        document.getElementById('submitBtn').addEventListener('click', () => {
            const form = document.getElementById('subsidieForm');
            const formData = new FormData(form);
            const doc = new jsPDF();

            doc.setFontSize(22);
            doc.text("Subsidie Aanvraag", 105, 20, null, null, 'center');

            let y = 40;
            vragen.forEach(vraag => {
                const value = formData.get(vraag.name);
                if(vraag.type !== "file") {
                    doc.setFontSize(14);
                    doc.text(`${vraag.label}: ${value}`, 20, y);
                    y += 10;
                }
            });

            const bankafschriften = formData.get('bankafschriften');
            const dashboard = formData.get('dashboard');

            if(bankafschriften && dashboard) {
                const reader1 = new FileReader();
                reader1.onload = function(e1) {
                    doc.addImage(e1.target.result, 'JPEG', 20, y, 80, 60);
                    const reader2 = new FileReader();
                    reader2.onload = function(e2) {
                        doc.addImage(e2.target.result, 'JPEG', 110, y, 80, 60);
                        doc.save(`${formData.get('bedrijf')}_subsidie_aanvraag.pdf`);
                    };
                    reader2.readAsDataURL(dashboard);
                };
                reader1.readAsDataURL(bankafschriften);
            }
        });
    </script>
</body>
</html>
