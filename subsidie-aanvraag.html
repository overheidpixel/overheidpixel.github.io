<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subsidie Aanvraag Formulier</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
</head>
<body>
    <header>
        <h1>Subsidie Aanvraag Formulier</h1>
        <p>Volg de stappen om je aanvraag in te dienen</p>
    </header>

    <div class="progress-bar">
        <div id="progress"></div>
    </div>

    <form id="wizardForm">
        <!-- Step 1: Bedrijf -->
        <div class="form-step active">
            <h2><i class="fas fa-info-circle"></i> Bedrijfsinformatie</h2>
            <label>Bedrijfsnaam</label>
            <input type="text" name="bedrijf" required>
            <label>Eigenaar</label>
            <input type="text" name="eigenaar" required>
            <div class="buttons">
                <button type="button" class="next-btn">Volgende <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>

        <!-- Step 2: Bankafschriften -->
        <div class="form-step">
            <h2><i class="fas fa-university"></i> Bankgegevens</h2>
            <label>Bankafschriften (upload foto)</label>
            <input type="file" name="bankafschriften" accept="image/*" required>
            <img id="previewBank" src="" alt="Bankafschriften Preview">
            <label>Dashboard (bossmenu screenshot)</label>
            <input type="file" name="dashboard" accept="image/*" required>
            <img id="previewDashboard" src="" alt="Dashboard Preview">
            <div class="buttons">
                <button type="button" class="prev-btn"><i class="fas fa-arrow-left"></i> Vorige</button>
                <button type="button" class="next-btn">Volgende <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>

        <!-- Step 3: Aanvraag -->
        <div class="form-step">
            <h2><i class="fas fa-edit"></i> Omschrijving aanvraag</h2>
            <label>Omschrijf je aanvraag</label>
            <textarea name="omschrijving" rows="6" required></textarea>
            <div class="buttons">
                <button type="button" class="prev-btn"><i class="fas fa-arrow-left"></i> Vorige</button>
                <button type="button" class="next-btn">Volgende <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>

        <!-- Step 4: Preview & PDF -->
        <div class="form-step">
            <h2><i class="fas fa-file-pdf"></i> Preview & Download</h2>
            <div class="preview">
                <div>
                    <label>Bankafschriften preview:</label>
                    <img id="finalPreviewBank" src="">
                </div>
                <div>
                    <label>Dashboard preview:</label>
                    <img id="finalPreviewDashboard" src="">
                </div>
            </div>
            <div class="buttons">
                <button type="button" class="prev-btn"><i class="fas fa-arrow-left"></i> Vorige</button>
                <button type="button" id="downloadBtn"><i class="fas fa-download"></i> Download PDF</button>
            </div>
        </div>
    </form>

    <script>
        const { jsPDF } = window.jspdf;

        const form = document.getElementById('wizardForm');
        const steps = Array.from(document.querySelectorAll('.form-step'));
        const progress = document.getElementById('progress');
        let currentStep = 0;

        function updateSteps() {
            steps.forEach((step, index) => {
                step.classList.toggle('active', index === currentStep);
            });
            progress.style.width = ((currentStep + 1) / steps.length * 100) + '%';
        }

        document.querySelectorAll('.next-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if(validateStep(steps[currentStep])){
                    currentStep++;
                    if(currentStep >= steps.length) currentStep = steps.length - 1;
                    updateSteps();
                    updatePreviewImages();
                }
            });
        });

        document.querySelectorAll('.prev-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                currentStep--;
                if(currentStep < 0) currentStep = 0;
                updateSteps();
                updatePreviewImages();
            });
        });

        function validateStep(step){
            const inputs = Array.from(step.querySelectorAll('input, textarea'));
            for(const input of inputs){
                if(!input.checkValidity()) {
                    input.reportValidity();
                    return false;
                }
            }
            return true;
        }

        function updatePreviewImages(){
            const bankFile = form.bankafschriften.files[0];
            const dashboardFile = form.dashboard.files[0];
            if(bankFile){
                const reader = new FileReader();
                reader.onload = e => {
                    document.getElementById('previewBank').src = e.target.result;
                    document.getElementById('finalPreviewBank').src = e.target.result;
                };
                reader.readAsDataURL(bankFile);
            }
            if(dashboardFile){
                const reader2 = new FileReader();
                reader2.onload = e => {
                    document.getElementById('previewDashboard').src = e.target.result;
                    document.getElementById('finalPreviewDashboard').src = e.target.result;
                };
                reader2.readAsDataURL(dashboardFile);
            }
        }

document.getElementById('downloadBtn').addEventListener('click', () => {
    const formData = new FormData(form);
    const doc = new jsPDF();
    const pageWidth = doc.internal.pageSize.getWidth();
    let y = 20;

    // Header dossier
    doc.setFontSize(20);
    doc.setFont("helvetica", "bold");
    doc.text("Subsidie Aanvraag Dossier", pageWidth / 2, y, { align: 'center' });
    y += 10;

    // Datum
    const today = new Date();
    doc.setFontSize(10);
    doc.setFont("helvetica", "normal");
    doc.text(`Datum: ${today.toLocaleDateString()}`, pageWidth - 20, y, { align: 'right' });
    y += 10;

    doc.setLineWidth(0.5);
    doc.line(20, y, pageWidth - 20, y); // horizontale lijn
    y += 10;

    // Bedrijfsinformatie sectie
    doc.setFontSize(14);
    doc.setFont("helvetica", "bold");
    doc.text("1. Bedrijfsinformatie", 20, y);
    y += 8;
    doc.setFont("helvetica", "normal");
    doc.setFontSize(12);
    doc.text(`Bedrijfsnaam: ${formData.get('bedrijf')}`, 25, y); y+=8;
    doc.text(`Eigenaar: ${formData.get('eigenaar')}`, 25, y); y+=15;

    doc.line(20, y, pageWidth - 20, y); // scheidingslijn
    y += 10;

    // Aanvraag omschrijving
    doc.setFontSize(14);
    doc.setFont("helvetica", "bold");
    doc.text("2. Omschrijving aanvraag", 20, y);
    y += 8;
    doc.setFont("helvetica", "normal");
    doc.setFontSize(12);
    const oms = formData.get('omschrijving');
    const omsLines = doc.splitTextToSize(oms, pageWidth - 40);
    doc.text(omsLines, 25, y);
    y += omsLines.length * 7 + 10;

    doc.line(20, y, pageWidth - 20, y); // scheidingslijn
    y += 10;

    // Afbeeldingen sectie
    doc.setFontSize(14);
    doc.setFont("helvetica", "bold");
    doc.text("3. Bijlagen", 20, y);
    y += 8;

    const bankFile = formData.get('bankafschriften');
    const dashFile = formData.get('dashboard');

    if(bankFile){
        const reader1 = new FileReader();
        reader1.onload = e1 => {
            doc.setFontSize(12);
            doc.setFont("helvetica", "normal");
            doc.text("Bankafschriften:", 25, y);
            y += 5;
            doc.addImage(e1.target.result, 'JPEG', 25, y, 80, 60);
            y += 65;

            if(dashFile){
                const reader2 = new FileReader();
                reader2.onload = e2 => {
                    doc.text("Dashboard (bossmenu):", 25, y);
                    y += 5;
                    doc.addImage(e2.target.result, 'JPEG', 25, y, 80, 60);
                    y += 65;

                    // Opslaan
                    doc.save(`${formData.get('bedrijf')}_subsidie_dossier.pdf`);
                };
                reader2.readAsDataURL(dashFile);
            } else {
                doc.save(`${formData.get('bedrijf')}_subsidie_dossier.pdf`);
            }
        };
        reader1.readAsDataURL(bankFile);
    } else {
        doc.save(`${formData.get('bedrijf')}_subsidie_dossier.pdf`);
    }
});


        updateSteps();
    </script>
</body>
</html>
